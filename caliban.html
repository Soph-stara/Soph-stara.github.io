<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caliban's Daughters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a2e;
            color: #eee;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            text-align: center;
            background-color: #16213e;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        h1 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background-color: #0f3460;
            border-radius: 5px;
        }

        .stat-item {
            font-weight: bold;
        }

        .card-display {
            background-color: #e94560;
            color: white;
            padding: 15px;
            max-width: 400px;
            border-radius: 10px;
            margin: 20px auto;
            min-height: 200px;
        }

        .card-display.level2 {
            background-color: #8b1538;
            border: 2px solid #ff6b6b;
        }

        .card-image {
            height: 180px;
            width: 120px;
            background-color: rgba(45, 27, 54, 0.1);
            margin: 10px auto;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid rgba(233, 69, 96, 0.3);
            font-size: 14px;
            text-align: center;
        }

        .character-setup {
            background-color: rgba(233, 69, 96, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 3px solid #e94560;
        }

        .choices {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        button {
            padding: 15px 25px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #e94560;
            color: white;
            flex: 1;
        }

        button:hover {
            background-color: #d63447;
        }

        .level2-btn {
            background-color: #8b1538;
        }

        .level2-btn:hover {
            background-color: #7a1230;
        }

        .hidden {
            display: none;
        }

        .message {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-style: italic;
        }

        .message.level2 {
            background-color: #4a0e1a;
            border: 1px solid #8b1538;
        }

        .story-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #0f3460;
            border-radius: 8px;
            line-height: 1.6;
        }

        .story-btn {
            background-color: #16213e;
            color: #eee;
            border: 1px solid #e94560;
            margin: 10px 5px;
            padding: 10px 20px;
        }

        .story-btn:hover {
            background-color: #e94560;
        }

        .roles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .role-btn {
            padding: 20px;
            background-color: #0f3460;
            border: 2px solid #e94560;
        }

        .role-btn:hover {
            background-color: #e94560;
        }

        .level2-warning {
            background-color: #4a0e1a;
            border: 2px solid #8b1538;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="start-screen" class="container">
        <h1>Caliban's Daughters</h1>
        <h3>A Game of Survival, Resistance, and Feminist History</h3>
        
        <div id="intro-story" class="story-section">
            <p><strong>Europe, 15th-17th centuries.</strong> The world is changing rapidly. Old ways of life are being destroyed as capitalism takes hold. Commons are being enclosed. Women are losing their economic independence.</p>
            
            <p>But the most dangerous change is yet to come: <em>the witch hunts.</em></p>
            
            <p>You are a woman with knowledge, skills, or independence that threatens the new social order. Your very existence is becoming suspicious...</p>
            
            <button onclick="showRoleSelection()" class="story-btn">Begin Your Story</button>
        </div>

        <div id="role-selection" class="story-section hidden">
            <h3>Who Are You?</h3>
            <p>Each woman faced different challenges:</p>
            
            <div class="roles">
                <button class="role-btn" onclick="selectRole('healer')">
                    <strong>Healer</strong><br>
                    <small>Knows herbs and remedies</small>
                </button>
                <button class="role-btn" onclick="selectRole('midwife')">
                    <strong>Midwife</strong><br>
                    <small>Helps with childbirth</small>
                </button>
                <button class="role-btn" onclick="selectRole('wise-woman')">
                    <strong>Wise Woman</strong><br>
                    <small>Keeper of old knowledge</small>
                </button>
                <button class="role-btn" onclick="selectRole('dissenter')">
                    <strong>Dissenter</strong><br>
                    <small>Speaks against injustice</small>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="game-screen" class="container hidden">
        <h1>Caliban's Daughters</h1>
        
        <div class="game-stats" id="game-stats">
            <div class="stat-item">Suspicion: <span id="suspicion">0</span>%</div>
            <div class="stat-item">Allies: <span id="allies">0</span></div>
            <div class="stat-item">Round: <span id="round">1</span>/10</div>
        </div>

        <div id="level2-warning" class="level2-warning hidden">
            <h3>‚ö†Ô∏è Level 2: The Trial ‚ö†Ô∏è</h3>
            <p>You have been captured and accused of witchcraft. Your goal is psychological survival through the ordeal.</p>
        </div>

        <div class="card-display" id="card-display">
            <h2 id="card-title">Ready to Begin</h2>
            <div class="card-image" id="card-image">üìú</div>
            <p id="card-scenario">Your story as a woman during the witch hunts is about to unfold...</p>
            <p id="card-context">Each card will present choices that could mean survival or danger.</p>
        </div>

        <div id="choices" class="choices hidden">
            <button id="choice-1" onclick="makeChoice(1)">
                <span id="choice-1-text">Choice 1</span>
            </button>
            <button id="choice-2" onclick="makeChoice(2)">
                <span id="choice-2-text">Choice 2</span>
            </button>
        </div>

        <button id="draw-btn" onclick="drawCard()">Draw Card</button>
        <div id="message" class="message hidden"></div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="container hidden">
        <h1>Game Over</h1>
        <h2 id="end-title"></h2>
        <p id="end-message"></p>
        <div id="theory-message" class="story-section"></div>
        <button onclick="restartGame()">Play Again</button>
    </div>

    <script>
        let player = {
            role: null,
            suspicion: 0,
            allies: 0,
            round: 0,
            despair: 0,
            level2: false
        };
        
        let currentCard = null;

        const ROLES = {
            healer: { name: "Healer", suspicion: 10, allies: 1 },
            midwife: { name: "Midwife", suspicion: 15, allies: 2 },
            "wise-woman": { name: "Wise Woman", suspicion: 5, allies: 1 },
            dissenter: { name: "Dissenter", suspicion: 20, allies: 0 }
        };

        const LEVEL1_CARDS = [
            {
                title: "The Moon",
                scenario: "Whispers spread that you meet with spirits at night.",
                context: "Rumors could quickly become deadly accusations.",
                choice1: { text: "Hide for a few nights", effects: { suspicion: -15 }, message: "You stay hidden until rumors die down." },
                choice2: { text: "Confront the gossips", effects: { suspicion: 20, allies: 1 }, message: "Your bold confrontation gains respect but draws attention." }
            },
            {
                title: "The Tower",
                scenario: "A local woman betrays your secret gathering.",
                context: "Trust could be broken by fear and desperation.",
                choice1: { text: "Disperse quietly", effects: { suspicion: -10 }, message: "You scatter safely but lose the gathering." },
                choice2: { text: "Defy the accuser", effects: { suspicion: 30, allies: -1 }, message: "Your defiance is seen as proof of guilt." }
            },
            {
                title: "The High Priestess",
                scenario: "A woman in labor calls for your help.",
                context: "Healing knowledge was both valued and dangerous.",
                choice1: { text: "Use your knowledge", effects: { suspicion: 20, allies: 1 }, message: "You save mother and child, but your skills are noticed." },
                choice2: { text: "Send someone else", effects: { suspicion: -10 }, message: "You stay safe but offer no help." }
            },
            {
                title: "The Hermit",
                scenario: "A woman from a neighboring village seeks your help, fleeing persecution.",
                context: "Networks of support among women were crucial for survival.",
                choice1: { text: "Help her escape", effects: { suspicion: 5, allies: 1 }, message: "You risk your safety to aid another." },
                choice2: { text: "Turn her away", effects: { suspicion: -5 }, message: "You protect yourself, but lose a potential ally." }
            },
            {
                title: "Death",
                scenario: "A woman in the village has been accused of witchcraft.",
                context: "Witch trials relied on community participation.",
                choice1: { text: "Speak in her defense", effects: { suspicion: 20, allies: 1 }, message: "Your words cast suspicion on you, but show courage." },
                choice2: { text: "Stay silent", effects: { suspicion: -5 }, message: "You preserve your safety, but guilt weighs on you." }
            }
        ];

        const LEVEL2_CARDS = [
            {
                title: "The Arrest",
                scenario: "Authorities strip you and search for 'devil's marks'.",
                context: "The Malleus Maleficarum demanded thorough examination.",
                choice1: { text: "Submit quietly", effects: { despair: -10 }, message: "Your compliance shows 'proper fear of God'." },
                choice2: { text: "Protest your innocence", effects: { despair: 15 }, message: "Your protests are seen as defiance - more evidence of guilt." }
            },
            {
                title: "The Interrogation",
                scenario: "The judge asks you to confess 'freely' before torture begins.",
                context: "Judges promised leniency to encourage confession.",
                choice1: { text: "Confess to minor charges", effects: { despair: 20 }, message: "Your confession is recorded, but they demand more names." },
                choice2: { text: "Maintain innocence", effects: { despair: 10 }, message: "Your refusal means torture is 'necessary to find truth'." }
            },
            {
                title: "The Strappado",
                scenario: "They prepare the pulley torture. 'Last chance to confess.'",
                context: "The strappado lifted victims by ropes tied to their wrists.",
                choice1: { text: "Confess under threat", effects: { despair: 15 }, message: "You break before torture begins." },
                choice2: { text: "Endure the torture", effects: { despair: 25 }, message: "The pain is unbearable, but you endure." }
            },
            {
                title: "The Prison Cell",
                scenario: "Alone in your cell, guards warn the Devil will tempt suicide.",
                context: "Prisoners were watched to prevent suicide.",
                choice1: { text: "Pray continuously", effects: { despair: -15 }, message: "Prayer gives you strength." },
                choice2: { text: "Plan escape", effects: { despair: 20 }, message: "Escape attempts prove your guilt." }
            },
            {
                title: "Name Others",
                scenario: "They demand you name accomplices.",
                context: "The witch hunt system required accusations to spread.",
                choice1: { text: "Give false names", effects: { despair: 30 }, message: "You doom innocent women." },
                choice2: { text: "Refuse to name anyone", effects: { despair: 10 }, message: "Your silence protects others but ensures more torture." }
            },
            {
                title: "The Final Judgment",
                scenario: "The judge announces your sentence.",
                context: "Most trials ended in execution.",
                choice1: { text: "Accept your fate", effects: { despair: 5 }, message: "You find peace in acceptance." },
                choice2: { text: "Make final appeal", effects: { despair: 15 }, message: "Your appeal is seen as proof you remain unrepentant." }
            }
        ];

        function showScreen(screenId) {
            document.querySelectorAll('.container').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showRoleSelection() {
            document.getElementById('intro-story').classList.add('hidden');
            document.getElementById('role-selection').classList.remove('hidden');
        }

        function selectRole(roleKey) {
            const role = ROLES[roleKey];
            player.role = role.name;
            player.suspicion = role.suspicion;
            player.allies = role.allies;
            player.round = 0;
            player.despair = 0;
            player.level2 = false;
            
            showScreen('game-screen');
            updateStats();
        }

        function updateStats() {
            document.getElementById('suspicion').textContent = Math.max(0, Math.min(100, player.suspicion));
            document.getElementById('allies').textContent = Math.max(0, player.allies);
            document.getElementById('round').textContent = player.round + 1;
            
            if (player.level2) {
                document.getElementById('despair').textContent = Math.max(0, Math.min(100, player.despair));
            }
        }

        function startLevel2() {
            player.level2 = true;
            player.despair = 0;
            player.round = 0;
            
            // Update UI for Level 2
            document.getElementById('level2-warning').classList.remove('hidden');
            document.getElementById('card-display').classList.add('level2');
            
            // Update stats display
            document.getElementById('game-stats').innerHTML = `
                <div class="stat-item">Despair: <span id="despair">0</span>%</div>
                <div class="stat-item">Allies: <span id="allies">${player.allies}</span></div>
                <div class="stat-item">Trial Round: <span id="round">1</span>/6</div>
            `;
            
            // Update buttons
            document.getElementById('draw-btn').classList.add('level2-btn');
            document.getElementById('choice-1').classList.add('level2-btn');
            document.getElementById('choice-2').classList.add('level2-btn');
            
            // Make sure draw button is visible and choices are hidden
            document.getElementById('draw-btn').classList.remove('hidden');
            document.getElementById('choices').classList.add('hidden');
            
            updateStats();
            showMessage("You are now in the hands of the witch hunters...", true);
        }

        function showMessage(text, isLevel2 = false) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.classList.remove('hidden');
            
            if (isLevel2) {
                messageEl.classList.add('level2');
            } else {
                messageEl.classList.remove('level2');
            }
        }

        function drawCard() {
            let deck = player.level2 ? LEVEL2_CARDS : LEVEL1_CARDS;
            let maxRounds = player.level2 ? 6 : 10;
            
            // Check if we've completed all rounds AFTER attempting to draw
            // This allows the final round to be played
            if (player.round >= maxRounds) {
                endGame();
                return;
            }

            // Get random card
            currentCard = deck[Math.floor(Math.random() * deck.length)];

            // Display card
            document.getElementById('card-title').textContent = currentCard.title;
            document.getElementById('card-image').textContent = player.level2 ? '‚öñÔ∏è' : 'üîÆ';
            document.getElementById('card-scenario').textContent = currentCard.scenario;
            document.getElementById('card-context').textContent = currentCard.context;

            // Show choices
            document.getElementById('choice-1-text').textContent = currentCard.choice1.text;
            document.getElementById('choice-2-text').textContent = currentCard.choice2.text;
            document.getElementById('choices').classList.remove('hidden');
            document.getElementById('draw-btn').classList.add('hidden');
            document.getElementById('message').classList.add('hidden');
        }

        function makeChoice(choiceNum) {
            const choice = choiceNum === 1 ? currentCard.choice1 : currentCard.choice2;

            // Apply effects
            if (choice.effects.suspicion) {
                player.suspicion += choice.effects.suspicion;
                player.suspicion = Math.max(0, Math.min(100, player.suspicion));
            }
            if (choice.effects.allies) {
                player.allies += choice.effects.allies;
                player.allies = Math.max(0, player.allies);
            }
            if (choice.effects.despair) {
                player.despair += choice.effects.despair;
                player.despair = Math.max(0, Math.min(100, player.despair));
            }

            // Show message
            showMessage(choice.message, player.level2);

            // Update round and stats
            player.round++;
            updateStats();

            // Hide choices
            document.getElementById('choices').classList.add('hidden');
            document.getElementById('draw-btn').classList.remove('hidden');

            // Check for transitions/endings
            if (player.level2) {
                if (player.despair >= 100) {
                    setTimeout(() => endGame('broken'), 2000);
                    return;
                }
                // Allow all 6 rounds to complete before ending
                if (player.round >= 6) {
                    setTimeout(() => endGame(), 2000);
                    return;
                }
            } else {
                if (player.suspicion >= 100) {
                    setTimeout(() => startLevel2(), 2000);
                    return;
                }
                // Allow all 10 rounds to complete before ending
                if (player.round >= 10) {
                    setTimeout(() => endGame(), 2000);
                    return;
                }
            }
        }

        function endGame(endingType = null) {
            showScreen('end-screen');
            
            let title, message, theory;
            
            if (endingType === 'broken') {
                title = "Your Spirit Was Broken";
                message = `The torture and psychological pressure destroyed your will. You confessed to impossible crimes.<br><br><em>Final Stats: ${player.despair}% despair overwhelmed you.</em>`;
                theory = `The Malleus Maleficarum created a system designed to break the human spirit through torture and false promises.`;
            } else if (player.level2) {
                if (player.despair >= 70) {
                    title = "You Were Executed";
                    message = `Despite surviving the trial process, you were sentenced to death. Your ${player.despair}% despair wasn't enough to break you completely.<br><br><em>You maintained dignity even facing death.</em>`;
                    theory = `Even those who endured with spirit intact often faced execution. The system eliminated women regardless of guilt or innocence.`;
                } else {
                    title = "You Survived the Trial";
                    message = `Incredibly, you survived both levels of persecution with only ${player.despair}% despair. You received life imprisonment instead of execution.<br><br><em>You represent the rare few who survived the complete process.</em>`;
                    theory = `Your survival represents an almost impossible achievement. Very few maintained psychological integrity through such ordeals.`;
                }
            } else {
                if (player.suspicion >= 70) {
                    title = "Under Suspicion";
                    message = `You survive, but barely. The community watches every move. You live in constant fear.<br><br><em>Final Stats: Suspicion ${player.suspicion}%, Allies: ${player.allies}</em>`;
                    theory = `Women who avoided execution often lived under constant surveillance - part of the witch hunts' true purpose: disciplining all women into submission.`;
                } else {
                    title = "Hidden Strength";
                    message = `You maintained integrity while building allies and keeping suspicion low. You represent the underground resistance.<br><br><em>Final Stats: Suspicion ${player.suspicion}%, Allies: ${player.allies}</em>`;
                    theory = `Some women successfully resisted by building strong networks of mutual support, preserving knowledge through the darkest times.`;
                }
            }
            
            document.getElementById('end-title').textContent = title;
            document.getElementById('end-message').innerHTML = message;
            document.getElementById('theory-message').innerHTML = `<h4>Historical Analysis</h4><p>${theory}</p>`;
        }

        function restartGame() {
            player = {
                role: null,
                suspicion: 0,
                allies: 0,
                round: 0,
                despair: 0,
                level2: false
            };
            
            // Reset UI
            document.getElementById('level2-warning').classList.add('hidden');
            document.getElementById('card-display').classList.remove('level2');
            document.getElementById('message').classList.remove('level2');
            document.getElementById('draw-btn').classList.remove('level2-btn');
            document.getElementById('choice-1').classList.remove('level2-btn');
            document.getElementById('choice-2').classList.remove('level2-btn');
            
            showScreen('start-screen');
            document.getElementById('intro-story').classList.remove('hidden');
            document.getElementById('role-selection').classList.add('hidden');
        }
    </script>
</body>
</html>