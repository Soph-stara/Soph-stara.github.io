<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caliban's Daughters</title>
    <style>
        /* === SIMPLE STYLING === */
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a2e;
            color: #eee;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            text-align: center;
            background-color: #16213e;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        h1 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background-color: #0f3460;
            border-radius: 5px;
        }

        .stat-item {
            font-weight: bold;
        }

        .card-display {
            background-color: #e94560;
            color: white;
            padding: 15px;
            max-width: 400px;
            border-radius: 10px;
            margin: 20px auto;
            min-height: 200px;
        }

        .card-image {
            height: 180px;
            width: 120px;
            background-color: rgba(45, 27, 54, 0.1);
            margin: 10px auto;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid rgba(233, 69, 96, 0.3);
        }

        .card-image img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 3px;
        }

        .character-setup {
            background-color: rgba(233, 69, 96, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 3px solid #e94560;
        }

        .game-mechanics-preview {
            background-color: rgba(15, 52, 96, 0.5);
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .choices {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        button {
            padding: 15px 25px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #e94560;
            color: white;
            flex: 1;
        }

        button:hover {
            background-color: #d63447;
        }

        .hidden {
            display: none;
        }

        .message {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-style: italic;
        }

        .story-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #0f3460;
            border-radius: 8px;
            line-height: 1.6;
        }

        .story-btn {
            background-color: #16213e;
            color: #eee;
            border: 1px solid #e94560;
            margin: 10px 5px;
            padding: 10px 20px;
        }

        .story-btn:hover {
            background-color: #e94560;
        }

        /* Role selection styling */
        .roles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .role-btn {
            padding: 20px;
            background-color: #0f3460;
            border: 2px solid #e94560;
        }

        .role-btn:hover {
            background-color: #e94560;
        }
    </style>
</head>
<body>
    <!-- === GAME SCREENS === -->
    
    <!-- Start Screen -->
    <div id="start-screen" class="container">
        <h1>Caliban's Daughters</h1>
        <h3>A Game of Survival, Resistance, and Feminist History</h3>
        
        <!-- Story Introduction -->
        <div id="intro-story" class="story-section">
            <p><strong>Europe, 15th-17th centuries.</strong> The world is changing rapidly. Old ways of life are being destroyed as capitalism takes hold. Commons are being enclosed. Women are losing their economic independence.</p>
            
            <p>But the most dangerous change is yet to come: <em>the witch hunts.</em></p>
            
            <p>You are a woman with knowledge, skills, or independence that threatens the new social order. Your very existence is becoming suspicious...</p>
            
            <button onclick="showRoleSelection()" class="story-btn">Begin Your Story</button>
            <button onclick="showHistoricalContext()" class="story-btn">Learn More About This Period</button>
        </div>

        <!-- Historical Context Screen -->
        <div id="historical-context" class="story-section hidden">
            <h3>The Historical Context</h3>
            <p><strong>The witch hunts were not about superstition.</strong> As feminist historian Silvia Federici argues in "Caliban and the Witch," they were a systematic attack on women's autonomy during the rise of capitalism.</p>
            
            <h4>Why Women Were Targeted:</h4>
            <ul style="text-align: left; max-width: 500px; margin: 0 auto;">
                <li><strong>Economic Independence:</strong> Women who lived alone, had their own income, or controlled property</li>
                <li><strong>Traditional Knowledge:</strong> Healers, midwives, and herbalists whose skills challenged emerging male-dominated medicine</li>
                <li><strong>Resistance to Change:</strong> Those who opposed new laws restricting women's behavior and mobility</li>
                <li><strong>Control of Reproduction:</strong> Women who knew about contraception, abortion, or childbirth</li>
            </ul>
            
            <p><em>"The witch hunt was a war against women; it was a coordinated effort to degrade them, demonize them, and destroy their social power."</em> - Silvia Federici</p>
            
            <button onclick="showRoleSelection()" class="story-btn">Choose Your Role</button>
            <button onclick="showIntroStory()" class="story-btn">Back</button>
        </div>

        <!-- Role Selection Screen -->
        <div id="role-selection" class="story-section hidden">
            <h3>Who Are You?</h3>
            <p>Each woman faced different challenges and had different resources for survival:</p>
            
            <div class="roles">
                <button class="role-btn" onclick="showRoleDetails('healer')">
                    <strong>Healer</strong><br>
                    <small>Knows herbs and remedies</small>
                </button>
                <button class="role-btn" onclick="showRoleDetails('midwife')">
                    <strong>Midwife</strong><br>
                    <small>Helps with childbirth</small>
                </button>
                <button class="role-btn" onclick="showRoleDetails('wise-woman')">
                    <strong>Wise Woman</strong><br>
                    <small>Keeper of old knowledge</small>
                </button>
                <button class="role-btn" onclick="showRoleDetails('dissenter')">
                    <strong>Dissenter</strong><br>
                    <small>Speaks against injustice</small>
                </button>
            </div>
            
            <button onclick="showHistoricalContext()" class="story-btn">Learn More About This Period</button>
        </div>

        <!-- Individual Role Details -->
        <div id="role-details" class="story-section hidden">
            <div id="role-story-content"></div>
            <button id="start-game-btn" class="story-btn">Begin as This Character</button>
            <button onclick="showRoleSelection()" class="story-btn">Choose Different Role</button>
        </div>
    </div>

    <!-- Character Introduction Screen -->
    <div id="character-intro" class="container hidden">
        <h1>Caliban's Daughters</h1>
        <div id="character-intro-content" class="story-section">
            <!-- Content will be filled by JavaScript -->
        </div>
        
        <div class="story-section">
            <h3>How to Play</h3>
            <p><strong>Each Round:</strong> You'll draw a tarot card representing a situation or challenge based on historical events during the witch hunts.</p>
            
            <p><strong>Your Choices:</strong> Each card offers two options - often a choice between safety and resistance, or between individual survival and helping others.</p>
            
            <p><strong>Consequences:</strong> Your choices affect your Suspicion Level and number of Allies. Both are crucial for survival.</p>
            
            <div class="game-mechanics-preview">
                <h4>Theoretical Foundation</h4>
                <p><em>This game is based on Silvia Federici's analysis in "Caliban and the Witch." You'll experience how the witch hunts functioned as a tool of primitive accumulation, destroying women's autonomy to enforce capitalist and patriarchal control.</em></p>
            </div>
        </div>
        
        <button onclick="proceedToGameplay()" class="story-btn">Begin Your Journey</button>
        <button onclick="showRoleSelection()" class="story-btn">Choose Different Character</button>
    </div>

    <!-- Main Game Screen -->
    <div id="game-screen" class="container hidden">
        <h1>Caliban's Daughters</h1>
        
        <!-- Game Statistics -->
        <div class="game-stats">
            <div class="stat-item">Suspicion: <span id="suspicion">0</span>%</div>
            <div class="stat-item">Allies: <span id="allies">0</span></div>
            <div class="stat-item">Round: <span id="round">1</span>/10</div>
        </div>

        <!-- Card Display Area -->
        <div class="card-display">
            <h2 id="card-title">Ready to Begin</h2>
            <div class="card-image" id="card-image">
                <img src="images/cover.jpg" alt="Caliban's Daughters Cover" />
            </div>
            <p id="card-scenario">Your story as a woman during the witch hunts is about to unfold...</p>
            <p id="card-context">Each card you draw will present you with a choice that could mean survival or danger.</p>
        </div>

        <!-- Choice Buttons -->
        <div id="choices" class="choices hidden">
            <button id="choice-1" onclick="makeChoice(1)">
                <span id="choice-1-text">Choice 1</span>
            </button>
            <button id="choice-2" onclick="makeChoice(2)">
                <span id="choice-2-text">Choice 2</span>
            </button>
        </div>

        <!-- Draw Card Button -->
        <button id="draw-btn" onclick="drawCard()">Draw Card</button>

        <!-- Game Messages -->
        <div id="message" class="message hidden"></div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="container hidden">
        <h1>Game Over</h1>
        <h2 id="end-title"></h2>
        <p id="end-message"></p>
        <div id="theory-message" class="story-section"></div>
        <button onclick="restartGame()">Play Again</button>
    </div>

    <script>
        // === GAME DATA === 
        // This is where you add your tarot cards and scenarios

        const TAROT_CARDS = [
            {
                title: "The Moon", // Tarot card name
                image: "images/moon.jpg", // ADD IMAGE PATH HERE
                scenario: "Whispers spread that you meet with spirits at night.", // What happens
                context: "Rumors could quickly become deadly accusations.", // Historical context
                choice1: {
                    text: "Hide for a few nights", // What the player can choose
                    effects: { suspicion: -15 }, // What happens to stats
                    message: "You stay hidden until the rumors die down." // Result message
                },
                choice2: {
                    text: "Confront the gossips",
                    effects: { suspicion: +20, allies: +1 },
                    message: "Your bold confrontation gains respect but draws attention."
                }
            },
            {
                title: "The Tower",
                image: "images/tower.jpg", // ADD IMAGE PATH HERE
                scenario: "A local woman betrays your secret gathering.",
                context: "Trust could be broken by fear and desperation.",
                choice1: {
                    text: "Disperse quietly",
                    effects: { suspicion: -10 },
                    message: "You scatter safely but lose the gathering."
                },
                choice2: {
                    text: "Defy the accuser",
                    effects: { suspicion: +30, allies: -1 },
                    message: "Your defiance is seen as proof of guilt."
                }
            },
            {
                title: "The High Priestess",
                image: "images/high_priestess.jpg", // ADD IMAGE PATH HERE
                scenario: "A woman in labor calls for your help.",
                context: "Healing knowledge was both valued and dangerous.",
                choice1: {
                    text: "Use your knowledge",
                    effects: { suspicion: +20, allies: +1 },
                    message: "You save mother and child, but your skills are noticed."
                },
                choice2: {
                    text: "Send someone else",
                    effects: { suspicion: -10 },
                    message: "You stay safe but offer no help."
                }
            },
            {
                title: "The Hermit",
                image: "images/hermit.jpg", // ADD IMAGE PATH HERE
                scenario: "A woman from a neighboring village seeks your help, fleeing persecution.",
                context: "Networks of support among women were crucial for survival.",
                choice1: {
                    text: "Help her escape",
                    effects: { suspicion: +5, allies: +1 },
                    message: "You risk your safety to aid another. She will remember your kindness."
                },
                choice2: {
                    text: "Turn her away",
                    effects: { suspicion: -5 },
                    message: "You protect yourself, but lose a potential ally."
                }
            },
            {
                title: "Death",
                image: "images/death.jpg", // ADD IMAGE PATH HERE
                scenario: "A woman in the village has been accused of witchcraft and awaits trial.",
                context: "Witch trials relied on community participation. Speaking out risked attention.",
                choice1: {
                    text: "Speak in her defense",
                    effects: { suspicion: +20, allies: +1 },
                    message: "Your words cast suspicion on you, but you've shown great courage."
                },
                choice2: {
                    text: "Stay silent",
                    effects: { suspicion: -5 },
                    message: "You preserve your safety, but the guilt weighs on you."
                }
            },
            {
                title: "The Devil",
                image: "images/devil.jpg", // ADD IMAGE PATH HERE
                scenario: "The local priest warns about women who defy natural order and church teachings.",
                context: "Religious authorities played a central role in controlling women's knowledge.",
                choice1: {
                    text: "Question his teachings secretly",
                    effects: { allies: +1 },
                    message: "Others share your doubts. You form a quiet network of dissenters."
                },
                choice2: {
                    text: "Attend church dutifully",
                    effects: { suspicion: -10 },
                    message: "Your public piety provides some protection."
                }
            },
            {
                title: "The Empress",
                image: "images/empress.jpg", // ADD IMAGE PATH HERE
                scenario: "Your knowledge of reproductive medicine could help a suffering noblewoman.",
                context: "Control over reproduction was a key battlefield during witch hunts.",
                choice1: {
                    text: "Offer your services",
                    effects: { suspicion: -15 },
                    message: "The noblewoman recovers and becomes your protector."
                },
                choice2: {
                    text: "Keep your knowledge hidden",
                    effects: { suspicion: -5 },
                    message: "You remain safe but unseen."
                }
            },
            {
                title: "The Magician",
                image: "images/magician.jpg", // ADD IMAGE PATH HERE
                scenario: "You discover an ancient text with forbidden knowledge.",
                context: "Literacy among women was often restricted. Traditional texts were being destroyed.",
                choice1: {
                    text: "Study it in secret",
                    effects: { allies: +1 },
                    message: "The knowledge connects you to an underground network of learned women."
                },
                choice2: {
                    text: "Destroy the text",
                    effects: { suspicion: -10 },
                    message: "You eliminate evidence that could condemn you."
                }
            },
            {
                title: "Justice",
                image: "images/justice.jpg", // ADD IMAGE PATH HERE
                scenario: "A local official offers you protection in exchange for naming other 'suspicious' women.",
                context: "The witch hunt machinery relied on forced confessions and denunciations.",
                choice1: {
                    text: "Refuse the offer",
                    effects: { suspicion: +15, allies: +1 },
                    message: "Your integrity remains intact, earning the trust of other women."
                },
                choice2: {
                    text: "Provide false names",
                    effects: { suspicion: -10 },
                    message: "You buy yourself time, but at what cost to your conscience?"
                }
            },
            {
                title: "The Star",
                image: "images/star.jpg", // ADD IMAGE PATH HERE
                scenario: "A midnight gathering of women is planned to share knowledge and resources.",
                context: "Women's gatherings were often criminalized but important for mutual support.",
                choice1: {
                    text: "Attend the gathering",
                    effects: { suspicion: +10, allies: +2 },
                    message: "The connection with other women strengthens your resolve and knowledge."
                },
                choice2: {
                    text: "Stay home",
                    effects: { suspicion: -5 },
                    message: "You remain isolated but avoid immediate danger."
                }
            },
            {
                title: "The Fool",
                image: "images/fool.jpg",
                scenario: "A young woman arrives in your village claiming to organize resistance against the new enclosure laws. She seeks women willing to join her cause.",
                context: "During the transition to capitalism, many displaced people moved between towns. Some organized resistance, but authorities were quick to label such groups as dangerous conspiracies.",
                choice1: {
                    text: "Join the cause",
                    effects: { suspicion: +10, allies: +1 },
                    message: "You take a leap of faith and join their movement. It's risky, but you're no longer alone in your resistance."
                },
                choice2: {
                    text: "Decline and stay hidden",
                    effects: { suspicion: -5 },
                    message: "You choose safety over solidarity, watching the opportunity pass by."
                }
            },
            {
                title: "Temperance",
                image: "images/temperance.jpg",
                scenario: "Two families are feuding over a boundary dispute that threatens to escalate. Both sides ask you to witness their claims and help resolve the matter.",
                context: "Women often served as informal mediators in community disputes. This role required careful balance - being helpful without appearing to overstep male authority, while maintaining relationships with all parties.",
                choice1: {
                    text: "Mediate and create peace",
                    effects: { suspicion: -10 },
                    message: "Your careful diplomacy and measured words restore harmony. Both families respect your wisdom and discretion."
                },
                choice2: {
                    text: "Subtly encourage the conflict",
                    effects: { suspicion: +10, allies: +1 },
                    message: "You deliberately stoke tensions to keep attention focused elsewhere, using the chaos as cover for your own activities."
                }
            },
            {
                title: "The Lovers",
                image: "images/lovers.jpg",
                scenario: "Another woman, also living on the margins of society, offers to share her hidden shelter. 'We're stronger together,' she says, extending both protection and companionship.",
                context: "In a world designed to isolate women and break their bonds, choosing to trust another person was both a radical act and a dangerous vulnerability. Close relationships could provide survival but also create new risks.",
                choice1: {
                    text: "Trust and join them",
                    effects: { suspicion: -10, allies: +1 },
                    message: "You choose vulnerability over safety. The deep connection and shared trust creates a powerful bond that strengthens you both."
                },
                choice2: {
                    text: "Push them away for safety",
                    effects: { suspicion: -5, allies: -1 },
                    message: "You protect yourself through isolation, but lose the chance for meaningful connection and mutual support."
                }
            },
            {
                title: "Strength",
                image: "images/strength.jpg",
                scenario: "In the village square, a desperate woman is being publicly flogged for stealing bread to feed her children. The crowd watches in silence as the lash falls.",
                context: "Public punishments were designed to intimidate communities into compliance. Speaking out required immense moral courage, as it could mark you as a troublemaker who sympathized with criminals and challenged authority.",
                choice1: {
                    text: "Step in to stop it",
                    effects: { suspicion: +25, allies: +1 },
                    message: "Your quiet courage overcomes fear. You step forward with gentle but unwavering resolve, risking everything to protect the vulnerable."
                },
                choice2: {
                    text: "Look away in silence",
                    effects: { suspicion: -5 },
                    message: "You choose safety over moral action, but the weight of inaction sits heavy on your conscience."
                }
            },
            {
                title: "The Hanged Woman",
                image: "images/hanged_man.jpg",
                scenario: "The other women in your village council tell you to remain quiet while they negotiate with authorities about new restrictions on market trading. 'Let us handle this,' they insist.",
                context: "Women often had to choose between collective patience and individual action. Sometimes waiting was strategic - letting others take the visible risks. Other times, bold individual action was needed to break patterns of oppression.",
                choice1: {
                    text: "Endure in silence and wait",
                    effects: { suspicion: -10 },
                    message: "You accept the suspended state, trusting in collective wisdom. Your patient sacrifice allows others to act while you remain protected."
                },
                choice2: {
                    text: "Take initiative alone",
                    effects: { suspicion: +15, allies: +1 },
                    message: "You break the pattern of waiting and act independently. Your bold move disrupts the status quo and inspires others."
                }
            },
            {
                title: "The Chariot",
                image: "images/chariot.jpg",
                scenario: "A merchant caravan offers passage to a distant region where witch hunts are less frequent. 'Come with us,' they urge. 'Start fresh where no one knows your past.'",
                context: "Many women fled persecution by joining traveling merchants or moving to new territories. However, leaving meant abandoning your community and any chance to resist the systems destroying women's lives.",
                choice1: {
                    text: "Join the caravan",
                    effects: { suspicion: -30 },
                    message: "You choose escape over resistance, leaving behind everything you've built but gaining the chance for a new life."
                },
                choice2: {
                    text: "Stay and fight",
                    effects: { suspicion: +20, allies: +1 },
                    message: "You master your conflicting desires and choose to remain, determined to resist rather than flee."
                }
            },
            {
                title: "The World",
                image: "images/world.jpg",
                scenario: "You discover women secretly building a hidden sanctuary in the forest - a place where traditional knowledge can be preserved and women can live by the old ways.",
                context: "Some women created alternative communities away from patriarchal control, preserving ancient wisdom and mutual aid. These refuges represented a complete alternative to the emerging capitalist order.",
                choice1: {
                    text: "Join their effort",
                    effects: { suspicion: +10, allies: +2 },
                    message: "You become part of something greater - a complete alternative world where women's knowledge and community can flourish."
                },
                choice2: {
                    text: "Pass through quietly",
                    effects: { suspicion: -5 },
                    message: "You choose not to commit to their vision, remaining an outsider to this new world they're creating."
                }
            },
            {
                title: "Wheel of Fortune",
                image: "images/wheel_of_fortune.jpg",
                scenario: "During Sunday mass, the priest delivers a fiery sermon specifically denouncing witches and calling on the congregation to report suspicious women.",
                context: "Religious sermons were often used to turn communities against suspected women. These moments were pivotal - how you responded could determine your fate, but the timing was beyond your control.",
                choice1: {
                    text: "Blend in at mass",
                    effects: { suspicion: -10 },
                    message: "You bow your head and recite prayers, becoming invisible in the crowd as fate's wheel turns around you."
                },
                choice2: {
                    text: "Speak a coded message",
                    effects: { suspicion: +15, allies: +1 },
                    message: "You seize the moment to send subtle signals to other women, turning the priest's words into an opportunity for resistance."
                }
            },
            {
                title: "Judgement",
                image: "images/judgement.jpg",
                scenario: "A suspicious neighbor corners you publicly, demanding you swear your innocence before God and the community. All eyes are upon you in this moment of reckoning.",
                context: "Public challenges to prove innocence were tests of both faith and identity. How you responded revealed not just your guilt or innocence, but your willingness to submit to patriarchal authority.",
                choice1: {
                    text: "Swear on the Bible",
                    effects: { suspicion: -15 },
                    message: "You submit to their judgment, performing the required ritual of innocence and conformity."
                },
                choice2: {
                    text: "Walk away with dignity",
                    effects: { suspicion: +20, allies: +1 },
                    message: "You refuse their false judgment, choosing truth over submission. Your defiance inspires others but marks you as dangerous."
                }
            },
            {
                title: "The Sun",
                image: "images/sun.jpg",
                scenario: "You stumble upon a group of women celebrating an ancient seasonal ritual in a forest clearing, their joy and laughter ringing through the trees.",
                context: "Traditional celebrations and women's rituals were increasingly banned as 'pagan.' These moments of joy and spiritual connection were both liberating and dangerous - visible celebrations of the old ways.",
                choice1: {
                    text: "Join and help lead it",
                    effects: { suspicion: +20, allies: +1 },
                    message: "You step into the sunlight of celebration, bringing joy and truth into the open despite the danger of visibility."
                },
                choice2: {
                    text: "Warn them to hide",
                    effects: { suspicion: -10 },
                    message: "You choose caution over celebration, urging them to extinguish their light and hide their joy from watching eyes."
                }
            }
            // === YOU CAN ADD MORE CARDS FROM YOUR TAROT DOCUMENT HERE ===
            // Copy the format above and use your detailed card descriptions from the PDF
        ];

        // === GAME STATE ===
        // This tracks what's happening in the game
        
        let gameState = {
            role: "",           // What role the player chose
            suspicion: 0,       // How suspicious the player is (0-100)
            allies: 0,          // How many allies the player has
            round: 1,           // What round we're on
            maxRounds: 10,      // Maximum rounds before game ends
            deck: [],           // Cards left to draw
            currentCard: null   // The card currently being played
        };

        // === ROLE DETAILS ===
        // Detailed backstories for each role
        
        const ROLE_STORIES = {
            'healer': {
                title: "The Healer",
                story: `<h3>Margaret the Healer</h3>
                <p>You are Margaret, a village healer who learned the properties of herbs from your grandmother. For years, people have come to you when the official physicians failed them - or when they couldn't afford their services.</p>
                
                <p><strong>Your Knowledge:</strong> You know which plants ease pain, which can help a difficult birth, and which can prevent pregnancy. This knowledge has saved lives, but it also makes you dangerous to those who want to control women's bodies.</p>
                
                <p><strong>Your Situation:</strong> Recently, a priest has been preaching against "folk magic" and the new university-trained physicians claim your methods are primitive. Some villagers still trust you, but others whisper that your successes come from dark powers.</p>
                
                <p><strong>Starting Conditions:</strong> Medium suspicion, few initial allies, but your skills can help reduce danger in some situations.</p>`,
                suspicion: 20,
                allies: 0
            },
            'midwife': {
                title: "The Midwife", 
                story: `<h3>Agnes the Midwife</h3>
                <p>You are Agnes, a midwife who has delivered hundreds of babies. Mothers trust you with their most vulnerable moments, and you hold knowledge about women's bodies that few others possess.</p>
                
                <p><strong>Your Knowledge:</strong> You understand childbirth, can ease labor pains, and know the old songs and rituals that comfort mothers. You also know which herbs can end an unwanted pregnancy - knowledge that's becoming increasingly dangerous.</p>
                
                <p><strong>Your Situation:</strong> The Church is trying to control childbirth, requiring priests to be present at births. Male physicians are claiming that women are unfit to practice medicine. Your very profession is under attack.</p>
                
                <p><strong>Starting Conditions:</strong> Some suspicion but stronger community support. Many mothers will defend you, giving you more initial allies.</p>`,
                suspicion: 25,
                allies: 1
            },
            'wise-woman': {
                title: "The Wise Woman",
                story: `<h3>Eleanor the Wise Woman</h3>
                <p>You are Eleanor, keeper of the old ways. You remember the stories, know the seasonal rituals, and understand the connections between earth, sky, and human life that others have forgotten.</p>
                
                <p><strong>Your Knowledge:</strong> You know weather patterns, can read signs in nature, and remember the old laws that protected common lands. You also hold knowledge of traditions that the Church calls "pagan" - knowledge that's becoming illegal.</p>
                
                <p><strong>Your Situation:</strong> As common lands are enclosed and old customs banned, your role as keeper of traditional knowledge makes you a symbol of the disappearing world. Some see you as a relic, others as a threat to the new order.</p>
                
                <p><strong>Starting Conditions:</strong> Higher suspicion but respected by those who remember the old ways. Your wisdom can sometimes attract allies who seek to preserve tradition.</p>`,
                suspicion: 35,
                allies: 1
            },
            'dissenter': {
                title: "The Dissenter",
                story: `<h3>Joanna the Dissenter</h3>
                <p>You are Joanna, a woman who refuses to accept the new restrictions on your life. When laws were passed requiring women to have male guardians, you spoke out. When common lands were enclosed, you protested.</p>
                
                <p><strong>Your Stance:</strong> You believe women should have the right to live independently, to practice trades, to speak in public. You've seen how the new economic system enriches a few while impoverishing many, and you're not afraid to say so.</p>
                
                <p><strong>Your Situation:</strong> Your outspokenness has already marked you as a troublemaker. Authorities know your name and watch your activities. But your courage has also inspired other women who share your views.</p>
                
                <p><strong>Starting Conditions:</strong> High suspicion from your known resistance, but you've already gathered allies who believe in your cause.</p>`,
                suspicion: 40,
                allies: 2
            }
        };

        // === NAVIGATION FUNCTIONS ===
        
        function showIntroStory() {
            document.getElementById('intro-story').classList.remove('hidden');
            document.getElementById('historical-context').classList.add('hidden');
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('role-details').classList.add('hidden');
        }

        function showHistoricalContext() {
            document.getElementById('intro-story').classList.add('hidden');
            document.getElementById('historical-context').classList.remove('hidden');
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('role-details').classList.add('hidden');
        }

        function showRoleSelection() {
            document.getElementById('intro-story').classList.add('hidden');
            document.getElementById('historical-context').classList.add('hidden');
            document.getElementById('role-selection').classList.remove('hidden');
            document.getElementById('role-details').classList.add('hidden');
            document.getElementById('character-intro').classList.add('hidden');
        }

        function showRoleDetails(role) {
            document.getElementById('intro-story').classList.add('hidden');
            document.getElementById('historical-context').classList.add('hidden');
            document.getElementById('role-selection').classList.add('hidden');
            document.getElementById('role-details').classList.remove('hidden');
            
            // Show the role's detailed story
            const roleData = ROLE_STORIES[role];
            document.getElementById('role-story-content').innerHTML = roleData.story;
            
            // Set up the start button for this role
            document.getElementById('start-game-btn').onclick = () => startGame(role);
        }

        // === GAME FUNCTIONS ===

        function startGame(selectedRole) {
            console.log("Starting game with role:", selectedRole); // Debug line
            
            // Set up the game with chosen role
            gameState.role = selectedRole;
            gameState.suspicion = ROLE_STORIES[selectedRole].suspicion;
            gameState.allies = ROLE_STORIES[selectedRole].allies;
            gameState.round = 1;
            
            // Create shuffled deck of cards
            gameState.deck = [...TAROT_CARDS]; // Copy the cards array
            shuffleArray(gameState.deck);      // Randomize the order!
            console.log("Shuffled deck:", gameState.deck); // Debug: see the random order
            
            // Show the character introduction screen first
            showCharacterIntroduction(selectedRole);
        }

        function showCharacterIntroduction(role) {
            console.log("Setting up character intro for:", role); // Debug
            console.log("Role data:", ROLE_STORIES[role]); // Debug
            
            // Hide start screen and show character intro
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('character-intro').classList.remove('hidden');
            
            // Fill in character intro content
            const roleData = ROLE_STORIES[role];
            document.getElementById('character-intro-content').innerHTML = `
                <h2>You are ${roleData.title}</h2>
                <div class="character-setup">
                    <p><strong>Your situation:</strong> The year is 1580. The witch hunts have been spreading across Europe for decades. You live in a small village where everyone knows everyone else's business.</p>
                    
                    <p><strong>Your knowledge makes you valuable...</strong> People come to you when they need help. But that same knowledge makes you dangerous in the eyes of the authorities.</p>
                    
                    <p><strong>Your starting position:</strong></p>
                    <ul>
                        <li>Suspicion Level: ${roleData.suspicion}% (how much attention you've already drawn)</li>
                        <li>Allies: ${roleData.allies} (people who trust and support you)</li>
                    </ul>
                    
                    <p><em>Your goal is to survive 10 rounds of challenges while managing suspicion and building alliances. Too much suspicion (100%) means capture and death. Allies can help protect you and provide alternative paths to survival.</em></p>
                </div>
            `;
        }

        function proceedToGameplay() {
            // Now transition to the actual game
            document.getElementById('character-intro').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            // Make sure the stats are properly initialized
            updateDisplay();
            
            // Show initial game message
            showMessage(`Your journey begins as ${ROLE_STORIES[gameState.role].title.toLowerCase()}. The village feels tense today. Someone mentioned seeing lights in the forest last night... Click "Draw Card" when you're ready for your first challenge.`);
        }

        function drawCard() {
            // Check if deck is empty
            if (gameState.deck.length === 0) {
                endGame('survived');
                return;
            }
            
            // Get the next card
            gameState.currentCard = gameState.deck.pop();
            
            // Show the card
            document.getElementById('card-title').textContent = gameState.currentCard.title;
            document.getElementById('card-scenario').textContent = gameState.currentCard.scenario;
            document.getElementById('card-context').textContent = gameState.currentCard.context;
            
            // === DISPLAY THE CARD IMAGE ===
            const cardImageEl = document.getElementById('card-image');
            if (gameState.currentCard.image) {
                // If there's an image path, show the image
                cardImageEl.innerHTML = `<img src="${gameState.currentCard.image}" alt="${gameState.currentCard.title}" onerror="this.style.display='none'; this.parentElement.textContent='${gameState.currentCard.title}';" />`;
            } else {
                // If no image, show the card title as fallback
                cardImageEl.textContent = gameState.currentCard.title;
            }
            
            // Show choice buttons
            document.getElementById('choice-1-text').textContent = gameState.currentCard.choice1.text;
            document.getElementById('choice-2-text').textContent = gameState.currentCard.choice2.text;
            document.getElementById('choices').classList.remove('hidden');
            
            // Hide draw button
            document.getElementById('draw-btn').classList.add('hidden');
            
            // Hide any previous message
            document.getElementById('message').classList.add('hidden');
        }

        function makeChoice(choiceNumber) {
            // Get the chosen option
            const choice = choiceNumber === 1 ? gameState.currentCard.choice1 : gameState.currentCard.choice2;
            
            // Apply the effects
            applyEffects(choice.effects);
            
            // Show the result message
            showMessage(choice.message);
            
            // Hide choices
            document.getElementById('choices').classList.add('hidden');
            
            // Check if game should end
            if (gameState.suspicion >= 100) {
                setTimeout(() => endGame('captured'), 2000);
                return;
            }
            
            // Advance to next round
            gameState.round++;
            if (gameState.round > gameState.maxRounds) {
                setTimeout(() => endGame('survived'), 2000);
                return;
            }
            
            // Show draw button for next card
            setTimeout(() => {
                document.getElementById('draw-btn').classList.remove('hidden');
                updateDisplay();
            }, 2000);
        }

        function applyEffects(effects) {
            // Change suspicion
            if (effects.suspicion) {
                gameState.suspicion += effects.suspicion;
                
                // Keep suspicion between 0 and 100
                gameState.suspicion = Math.max(0, Math.min(100, gameState.suspicion));
            }
            
            // Change allies
            if (effects.allies) {
                gameState.allies += effects.allies;
                gameState.allies = Math.max(0, gameState.allies); // Can't have negative allies
            }
            
            updateDisplay();
        }

        function updateDisplay() {
            // Update all the numbers on screen
            document.getElementById('suspicion').textContent = gameState.suspicion;
            document.getElementById('allies').textContent = gameState.allies;
            document.getElementById('round').textContent = gameState.round;
        }

        function showMessage(text) {
            // Show a message to the player
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.classList.remove('hidden');
        }

        function endGame(outcome) {
            // Switch to end screen
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            
            // Determine specific ending based on outcome and player stats
            if (outcome === 'captured') {
                showCapturedEnding();
            } else if (outcome === 'survived') {
                if (gameState.allies >= 4) {
                    showResistanceEnding();
                } else if (gameState.allies >= 2) {
                    showSolidarityEnding();
                } else {
                    showSurvivalEnding();
                }
            }
        }

        function showCapturedEnding() {
            document.getElementById('end-title').textContent = "You Were Captured";
            document.getElementById('end-message').innerHTML = `
                <p><strong>Your suspicion reached 100%.</strong> The authorities have been watching you for too long.</p>
                
                <p>You are accused of witchcraft and taken for trial. Like hundreds of thousands of women during this period, your knowledge, independence, or resistance to the new social order has marked you as dangerous.</p>
                
                <p><em>Final Stats: ${gameState.allies} allies tried to help you, but it wasn't enough to overcome ${gameState.suspicion}% suspicion.</em></p>
            `;
            
            document.getElementById('theory-message').innerHTML = `
                <h3>Historical Reality</h3>
                <p><strong>The witch hunts claimed an estimated 200,000-500,000 lives, 80-85% of them women.</strong></p>
                
                <p>As Silvia Federici argues, these weren't random acts of superstition. They were a systematic campaign to destroy women's autonomy during the transition to capitalism. Women with knowledge (healers, midwives), economic independence, or who resisted new patriarchal norms were specifically targeted.</p>
                
                <p><em>"The witch hunt was a war against women; it was a coordinated effort to degrade them, demonize them, and destroy their social power."</em> - Silvia Federici</p>
                
                <p>Your story represents the countless women who fell victim to this system of control.</p>
            `;
        }

        function showResistanceEnding() {
            document.getElementById('end-title').textContent = "You Built a Network of Resistance";
            document.getElementById('end-message').innerHTML = `
                <p><strong>You survived with ${gameState.allies} strong allies!</strong> Through solidarity and mutual support, you've created an underground network of women who resist the witch hunts.</p>
                
                <p>Your knowledge is preserved and shared secretly. You've helped other women escape persecution. Together, you represent the power of collective resistance against oppression.</p>
                
                <p><em>Final Stats: ${gameState.suspicion}% suspicion, but ${gameState.allies} allies protected you and built something larger.</em></p>
            `;
            
            document.getElementById('theory-message').innerHTML = `
                <h3>The Power of Solidarity</h3>
                <p><strong>Some women survived through networks of mutual aid and resistance.</strong></p>
                
                <p>Federici emphasizes that women didn't passively accept their fate. They formed underground networks, preserved traditional knowledge, and supported each other. Your ending represents this historical reality of resistance.</p>
                
                <p>As bell hooks and Angela Davis argue, collective resistance by marginalized groups can challenge systems of oppression. Your network embodies this potential for transformative solidarity.</p>
                
                <p><em>You've demonstrated that even under extreme persecution, women's solidarity can create spaces of resistance and survival.</em></p>
            `;
        }

        function showSolidarityEnding() {
            document.getElementById('end-title').textContent = "You Survived Through Community";
            document.getElementById('end-message').innerHTML = `
                <p><strong>You made it through the dangerous period!</strong> With ${gameState.allies} allies supporting you, you managed to keep your suspicion at ${gameState.suspicion}% - low enough to avoid persecution.</p>
                
                <p>Your relationships with other women provided protection and support. While you couldn't build a large resistance network, you maintained connections that helped you survive.</p>
                
                <p><em>You represent the many women who survived through careful relationship-building and mutual support.</em></p>
            `;
            
            document.getElementById('theory-message').innerHTML = `
                <h3>Community as Survival Strategy</h3>
                <p><strong>Many women survived the witch hunts through careful community building.</strong></p>
                
                <p>Your experience reflects how women used relationships and community ties as protection against persecution. This aligns with feminist theories about how marginalized groups use solidarity networks as survival strategies.</p>
                
                <p>Federici notes that women's communities were both a target of witch hunts and a source of resistance. Your survival demonstrates the protective power of these bonds.</p>
            `;
        }

        function showSurvivalEnding() {
            document.getElementById('end-title').textContent = "You Survived Alone";
            document.getElementById('end-message').innerHTML = `
                <p><strong>You made it through, but at a cost.</strong> With only ${gameState.allies} allies and ${gameState.suspicion}% suspicion, you survived by keeping your head down and avoiding attention.</p>
                
                <p>Your knowledge remains hidden, your connections limited. You're alive, but the system has succeeded in isolating you and limiting your power.</p>
                
                <p><em>You represent the many women who survived by becoming invisible and suppressing their autonomy.</em></p>
            `;
            
            document.getElementById('theory-message').innerHTML = `
                <h3>The Cost of Isolation</h3>
                <p><strong>Some women survived by accepting isolation and suppressing their autonomy.</strong></p>
                
                <p>Your ending reflects how the witch hunts succeeded even when women weren't killed - by forcing them to hide their knowledge, limit their independence, and avoid forming connections with other women.</p>
                
                <p>Federici argues that this isolation was part of the goal: to break women's collective power and force them into dependency on patriarchal family structures. Your survival came at the cost of your autonomy.</p>
                
                <p><em>This demonstrates how oppressive systems can "succeed" even when they don't destroy their targets completely.</em></p>
            `;
        }

        function restartGame() {
            // Reset everything and go back to start
            gameState = {
                role: "",
                suspicion: 0,
                allies: 0,
                round: 1,
                maxRounds: 10,
                deck: [],
                currentCard: null
            };
            
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            showIntroStory(); // Make sure we show the intro story when restarting
        }

        // === UTILITY FUNCTIONS ===

        function shuffleArray(array) {
            // Randomly mix up the order of cards
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>